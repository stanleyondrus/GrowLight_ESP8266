(function(f,d,a,c,h){var e="timerangewheel",g={width:240,height:240,margin:{top:20,left:20,bottom:20,right:20},offset:80,indicatorWidth:12,accentColor:"#d81b60",handleRadius:14,handleStrokeWidth:2,handleStrokeColor:"#ffffff",handleIconColor:"#333333",handleFillColorStart:"#ffffff",handleFillColorEnd:"#d81b60",rangeTotal:24,tickColor:"#f9f9f9",indicatorBackgroundColor:"#d3d3d3"};function b(j,i){this.element=j;this.settings=f.extend({},g,i);this._defaults=g;this._name=e;this.init()}f.extend(b.prototype,{graph:{svg:{},pie:{},arc:{}},helper:{settings:{},graphdata:[],calculateTime:function(j){var l=j<0?"-":"";var k=Math.floor(Math.abs(j));var i=Math.floor((Math.abs(j)*60)%60);return l+(k<10?"0":"")+k+":"+(i<10?"0":"")+(i-(i%5))},calculateTimeFromMinutes:function(k){var i=Math.floor(k/60);var j=k%60;return(i<10?"0":"")+i+":"+(j<10?"0":"")+j},calculateDuration:function(k,i){var l;var j=c.scaleLinear().range([0,288]).domain([0,360]);l=j(i)-j(k);if(l<0){l=288+l}return this.calculateTimeFromMinutes(l*5)},createTimeInfoObject:function(n){var j=c.scaleLinear().range([0,288]).domain([0,360]);var l,i,k,m,o;k=this.calculateTimeFromMinutes(j(n.aAngle)*5);m=this.calculateTimeFromMinutes(j(n.eAngle)*5);o=this.calculateDuration(n.aAngle,n.eAngle);return{start:k,end:m,duration:o}},calculateKnobInitialData:function(o){var i,m,k,p=0,l=0,n=0;var j=c.scaleLinear().range([0,360]).domain([0,this.settings.rangeTotal]);var q=c.scaleLinear().range([0,360]).domain([0,288]);k=o.start.split(":");n=k[0]*12;n+=(k[1]*1)/5;l=q(n);p=j.invert(l);this.graphdata.push({value:p,label:"a",angle:l});k=o.end.split(":");n=k[0]*12;n+=(k[1]*1)/5;l=q(n);p=j.invert(l);this.graphdata.push({value:p,label:"e",angle:l})},calculateKnobUpdateHandleData:function(l){var p,i,m,l=0,o=0,n=0;var j=c.scaleLinear().range([0,360]).domain([0,this.settings.rangeTotal]);var k=c.scaleLinear().range([0,360]).domain([0,288]);m=initialData.start.split(":");n=m[0]*12;n+=(m[1]*1)/5;o=k(n);l=j.invert(o);this.graphdata.push({value:l,label:"a",angle:o});m=initialData.end.split(":");n=m[0]*12;n+=(m[1]*1)/5;o=k(n);l=j.invert(o);this.graphdata.push({value:l,label:"e",angle:o})},getValueOfDataSet:function(i){var j=0;this.graphdata.forEach(function(l,k){if(l.label==i){j=l.value}});return j},getAngleOfDataSet:function(i){var j=0;this.graphdata.forEach(function(l,k){if(l.label==i){j=l.angle}});return j},getData:function(){return this.graphdata}},init:function(){var B=this;var r,u,k,i,o;var F,E,C,y;var s=null;var j=c.scaleLinear().range([0,360]).domain([0,this.settings.rangeTotal]);var n=c.scaleLinear().range([0,360]).domain([0,288]);var w=this.settings.height,z=this.settings.width,v=this.settings.margin;var m=(Math.min(z,w)-v.top-v.bottom)/2;var A=m+this.settings.indicatorWidth/2;var q=A-this.settings.indicatorWidth;var l=function(L,I){var J=c.select(this).classed("active",true);var K=c.mouse(B.graph.svg.node());var G=K[0]-m;var N=K[1]-m;var H;var M=(Math.atan2(N,G)*180/Math.PI)+90;if(M<0){M=360+M}M=M-((M*100)%125)/100;L.value=j.invert(M);L.angle=M.toFixed(2);if(L.angle!=s){s=L.angle;D(J);t(L.label)}};var p=function(O,I,N,K){var M=c.selectAll("#handles .handlercontainer");var J=0;var L=0;var H=0;var G;M.each(function(Q,P){if(Q.label=="a"){J=Q.angle}if(Q.label=="e"){L=Q.angle}});if(J*1>L*1){J=(J*1)-360}B.graph.arc=c.arc().innerRadius(q).outerRadius(A).startAngle(function(P){return J*(Math.PI/180)}).endAngle(function(P){return L*(Math.PI/180)});k.attr("d",B.graph.arc)};var x=function(){var G=i.selectAll(".handlercontainer").data(B.helper.getData());var H=G.enter().append("g").attr("class","handlercontainer").attr("transform",function(I){return"rotate("+j(I.value)+") translate(0,"+m*-1+")"}).on("mouseover",function(){c.select(this).classed("active",true)}).on("mouseout",function(){c.select(this).classed("active",false)}).call(o);H.append("circle").attr("r",B.settings.handleRadius).attr("class","handle").attr("stroke",B.settings.handleStrokeColor).attr("stroke-width",B.settings.handleStrokeWidth).attr("cursor","all-scroll").attr("fill",function(J,I){if(J.label=="a"){return B.settings.handleFillColorStart}else{return B.settings.handleFillColorEnd}}).attr("id",function(I){return I.label}).on("mouseover",function(){c.select(this).classed("active",true)}).on("mouseout",function(){c.select(this).classed("active",false)});H.append("text").attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-family","FontAwesome").attr("font-size","1em").attr("cursor","all-scroll").attr("fill",B.settings.handleIconColor).text(function(I){if(I.label=="a"){return"\uf054"}else{return"\uf053"}})};var D=function(G){G.attr("transform",function(I,H){p(I.value,H,I.label,I.angle);return"rotate("+j(I.value)+") translate(0,"+m*-1+")"})};var t=function(H){var I=i.selectAll(".handlercontainer");var J=0;var G={a:0,aAngle:0,e:0,eAngle:0};I.each(function(L,K){G[L.label]=L.value;G[L.label+"Angle"]=L.angle});B.writeTimeInfo(B.helper.createTimeInfoObject(G))};this.setSettings(this._defaults);f(this.element).empty();f(this.element).append(f("<div>").attr("class","knob"));this.helper.calculateKnobInitialData(this.settings.data);F=this.helper.getValueOfDataSet("a");E=this.helper.getValueOfDataSet("e");C=this.helper.getAngleOfDataSet("a");y=this.helper.getAngleOfDataSet("e");this.writeTimeInfo(B.helper.createTimeInfoObject({a:F,e:E,aAngle:C,eAngle:y}));this.graph.pie=c.pie().value(function(H,G){return H.value}).sort(null);this.graph.svg=c.select(".knob").append("svg").attr("height",this.settings.height+this.settings.offset).attr("width",this.settings.width+this.settings.offset).append("g").attr("id","holder").attr("transform","translate("+(((this.settings.width+this.settings.offset)-this.settings.width)/2+v.top)+","+(((this.settings.height+this.settings.offset)-this.settings.height)/2+v.left)+")");r=this.graph.svg.append("g").attr("id","ringbgrd").attr("transform","translate("+m+","+m+")");r.append("circle").attr("r",m).attr("class","ringbgrd").attr("stroke-width",this.settings.indicatorWidth-2).attr("stroke",this.settings.indicatorBackgroundColor).attr("stroke-dasharray",2).attr("fill","none");u=this.graph.svg.append("g").attr("id","arcindicator");if(C*1>y*1){C=(C*1)-360}this.graph.arc=c.arc().innerRadius(q).outerRadius(A).startAngle(function(G){return C*(Math.PI/180)}).endAngle(function(G){return y*(Math.PI/180)});k=u.append("g").attr("class","arcindicator").attr("transform","translate("+((this.settings.width/2)-20)+","+((this.settings.height/2)-20)+")").append("path").attr("fill",function(H,G){return B.settings.accentColor}).attr("d",B.graph.arc);i=this.graph.svg.append("g").attr("id","handles").attr("transform","translate("+m+","+m+")");o=c.drag().subject(function(G){return G}).on("drag",l).on("end",function(){c.select(this).classed("active",false)});x();this.drawClockTicks()},drawClockTicks:function(){var n=this;var k=this.graph.svg;var p;var q=n.settings.height,i=n.settings.width,j=n.settings.margin;var o=(Math.min(i,q)-j.top-j.bottom)/2;var m=o+n.settings.indicatorWidth/2+13;var l=function(s){var r=360/288;return c.range(0,288).map(function(t,u){return{angle:t*r,label:t%12?null:t/12}})};p=k.append("g").attr("id","ticks").attr("transform","translate("+o+","+o+")").selectAll("g").data(l).enter().append("g").attr("transform",function(r){return"rotate("+(r.angle-90)+")translate("+m+",0)"});p.append("line").attr("x1",1).attr("y1",0).attr("x2",function(r){if(r.label||r.angle==0){return 10}else{return 5}}).attr("y2",0).style("stroke",n.settings.tickColor);p.append("text").attr("x",5).attr("dy",".35em").attr("transform",function(r){return r.angle>180?"rotate(180)translate(-16)":"rotate(0)translate(7)"}).style("text-anchor",function(r){return r.angle>180?"end":null}).style("fill",n.settings.tickColor).style("font-size","10px").text(function(r){return r.label})},writeTimeInfo:function(i){if(typeof this.settings.onChange==="function"){this.settings.onChange(i)}},setSettings:function(i){this.helper.settings=this.settings}});f.fn[e]=function(i){if(!(this instanceof f)){f.extend(g,i)}return this.each(function(){if(!f.data(this,"plugin_"+e)){f.data(this,"plugin_"+e,new b(this,i))}})}})(jQuery,window,document,d3);